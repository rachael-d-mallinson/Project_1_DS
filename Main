import java.util.Scanner;

public class Main {
	/**
	 * Finds the Term with the largest exponent in the passed in ArrayList of Terms
	 * @param poly: the ArrayList of Terms
	 * @return: Term with the largest exponent
	 */
	private static Term findMaxTerm(ArrayList<Term> poly) {
		Iterator<Term> iterator = poly.iterator();
		int maxExp = Integer.MIN_VALUE;
		Term maxTerm = null;

		while (iterator.hasNext()) {
			Term tempTerm = iterator.next();
			int temp = tempTerm.getExponent();
			if (temp > maxExp) {
				maxExp = temp;
				maxTerm = tempTerm;
			}
		}
		return maxTerm;
	}
	
	/**
	 * Splits polynomials into Term objects comprised of coefficients and exponents
	 * @param input: A polynomial entered as a String
	 * @return: An ArrayList of Term objects
	 */
	public static ArrayList<Term> splitPolynomial(String input) {
		ArrayList<Term> terms = new ArrayList<>(); // Create a new ArrayList to hold terms
		input = input.replace("-", "+-"); // Replace all negatives with +-
		
		// Create a new ArrayList of Strings split at the plus sign
		List<String> poly = new ArrayList<String>(Arrays.asList(input.split("\\+"))); 

		// If any list items are empty, remove them
		for (int i = 0; i < poly.size(); i++) {
			if (poly.get(i).isEmpty()) {
				poly.remove(i);
			}
		}

		// Create variables to later be added to a Term object
		int constant = 0;
		int coefficient = 0;
		int exponent = 0;
		for (int i = 0; i < poly.size(); i++) {
			// If the list item has an exponent
			if (poly.get(i).contains("^")) {
				// If the last item in the string is the exponent notation
				if (poly.get(i).charAt(poly.get(i).length() - 1) == '^') {
					if (poly.get(i).charAt(0) == 'X') {
						coefficient = 1;
					} else if (poly.get(i).charAt(0) == '-' && poly.get(i).charAt(1) == 'X') {
						coefficient = -1;
					} else {
						coefficient = Integer.parseInt(poly.get(i).substring(0, poly.get(i).length() - 2));
					}
					// The exponent is the next item in the list
					exponent = Integer.parseInt(poly.get(i + 1));
					i++; // Advance i manually
				} else { // If the exponent notation is in the middle of the string
					// Split the string at the exponent notation
					String arr2[] = poly.get(i).split("\\^");
					if (arr2[0].charAt(0) == 'X') {
						coefficient = 1;
					} else if (arr2[0].charAt(0) == '-' && poly.get(i).charAt(1) == 'X') {
						coefficient = -1;
					} else {
						coefficient = Integer.parseInt(arr2[0].substring(0, arr2[0].length() - 1));
					}
					exponent = Integer.parseInt(arr2[1]);
				}
				// Create a new Term and add it to the ArrayList
				Term term = new Term(coefficient, exponent);
				terms.add(term);
				// If the list item contains X but no exponent notation
			} else if (poly.get(i).contains("X") && !poly.get(i).contains("^")) {
				if (poly.get(i).charAt(0) == 'X') {
					coefficient = 1;
				} else if (poly.get(i).charAt(0) == '-' && poly.get(i).charAt(1) == 'X') {
					coefficient = -1;
				} else {
					coefficient = Integer.parseInt(poly.get(i).substring(0, poly.get(i).length() - 1));
				}
				// Create a new Term and add it to the ArrayList
				Term term = new Term(coefficient, 1);
				terms.add(term);
				// If the list item does not contain X it is a constant
			} else if (!poly.get(i).contains("X")) {
				constant = Integer.parseInt(poly.get(i));
				// Add the Term to the ArrayList
				Term term = new Term(constant, 0);
				terms.add(term);
			}
		}

		return terms;
	}
	
	/**
	 * Sorted the ArrayList of polynomial terms by largest to smallest
	 * @param poly: the ArrayList of Terms
	 * @return sortedList: A sorted ArrayList of passed in terms by largest exponent to smallest
	 */
	public static ArrayList<Term> sort(ArrayList<Term> poly) {
		ArrayList<Term> sortedList = new ArrayList<>();
		Iterator<Term> iterator = poly.iterator();

		if (poly != null) {
			while (iterator.hasNext()) {
				Term maxTerm = findMaxTerm(poly);
				sortedList.add(maxTerm);
				poly.remove(maxTerm);
			}
		}
		return sortedList;
	}
	
	/**
	 * Reduces (adds) like terms inside the added polynomial ArrayList
	 * @param poly: the sorted ArrayList containing all the Terms of both polynomials
	 * @return: The sum of both polynomials with all like Terms added together
	 */
	public static ArrayList<Term> sumPolynomial(ArrayList<Term> poly) {
		ArrayList<Term> reducedList = new ArrayList<>();
		Term placeHolder = new Term(0, 0);
		reducedList.add(placeHolder);
		ListIterator<Term> iterator = poly.listIterator();

		if (poly != null) {
			while (iterator.hasNext()) {
				Term q = iterator.next();
				if (!iterator.hasNext()) {
					if (reducedList.get(reducedList.size() - 1).getExponent() == q.getExponent()) {
						break;
					} else {
						reducedList.add(q);
						break;
					}
				} else if (q.compareTo(iterator.next()) == 0) {
					Term p = iterator.previous();
					Term reduced = q.reduceLikeTerms(p);
					if (reduced.getCoefficient() == 0) {
						iterator.next();
						continue;
					} else {
						if (reducedList.get(reducedList.size() - 1).getExponent() == reduced.getExponent()) {
							reducedList.set(reducedList.size() - 1, reduced);
							p.setCoefficient(reduced.getCoefficient());
						} else {
							p.setCoefficient(reduced.getCoefficient());
							reducedList.add(reduced);
						}
					}

				} else {
					if (reducedList.isEmpty()) {
						reducedList.add(q);
					} else if (reducedList.get(reducedList.size() - 1).equals(q)) {
						iterator.previous();
						continue;
					} else {
						iterator.previous();
						reducedList.add(q);
					}
				}
			}
		}
		reducedList.remove(placeHolder);
		return reducedList;
	}
	
	/**
	 * Outputs a polynomial in a user-friendly way
	 * @param terms: An ArrayList of Terms
	 * @return: A polynomial as a String
	 */
	public static String outputPolynomial(ArrayList<Term> terms) {
		Iterator<Term> iterator = terms.iterator();
		StringBuilder poly = new StringBuilder();
		while (iterator.hasNext()) {
			Term term = iterator.next();
			if (term.getExponent() == 0) {
				if (term.getCoefficient() < 1) {
					if (poly.length() == 0) { poly.append(String.format("%d ", term.getCoefficient())); }
					else { poly.append(String.format("- %d ", Math.abs(term.getCoefficient()))); }
				} else {
					if (poly.length() == 0) { poly.append(String.format("%d ", term.getCoefficient())); }
					else { poly.append(String.format("+ %d ", term.getCoefficient())); }
				}
			} else if (term.getCoefficient() == 1 && term.getExponent() == 1) {
				if (poly.length() == 0) { poly.append("X "); }
				else { poly.append("+ X "); }
			} else if (term.getCoefficient() == -1 && term.getExponent() == 1) {
				if (poly.length() == 0) { poly.append("-X "); }
				else { poly.append("- X "); }
			} else if (term.getCoefficient() == 1 && term.getExponent() != 1) {
				if (poly.length() == 0) { poly.append(String.format("X^%d ", term.getExponent())); }
				else { poly.append(String.format("+ X^%d ", term.getExponent())); }
			} else if (term.getCoefficient() == -1 && term.getExponent() != 1) {
				if (poly.length() == 0) { poly.append(String.format("-X^%d ", term.getExponent())); }
				else { poly.append(String.format("- X^%d ", term.getExponent())); }
			} else {
				if (term.getCoefficient() < 1) {
					if (poly.length() == 0) { poly.append(String.format("-%dX^%d ", Math.abs(term.getCoefficient()), term.getExponent())); }
					else { poly.append(String.format("- %dX^%d ", Math.abs(term.getCoefficient()), term.getExponent())); }
				} else {
					if (poly.length() == 0) { poly.append(String.format("%dX^%d ", Math.abs(term.getCoefficient()), term.getExponent())); }
					else { poly.append(String.format("+ %dX^%d ", term.getCoefficient(), term.getExponent())); }
				}
			}		
		}
		return poly.toString();	
	}


	public static void main (String[] args) {
		Scanner scnr = new Scanner(System.in);
		
		//Make a user-friendly menu
		String UserMenuPrompt = "Polynomial Calculator\nPlease Choose your Menu Option by choosing a Number to enter.";
		String UserMenuOptions = " 1. Enter Two Polynomials to get the product 2. Quit\nEnter here:";
		boolean systemRunning = true;
		
		while (systemRunning) {
			System.out.println(UserMenuPrompt);		//title, and menu instructions
			System.out.print(UserMenuOptions);		//menu options
			int userChoice = scnr.nextInt();		//read in their choice
			String firstPoly = "";				//the first polynomial given
			String secondPoly = "";				//the second polynomial given
			ArrayList<Term> combined = new ArrayList<>(); 	// ArrayList to store both polynomials
		
			if (userChoice == 1) {
				System.out.print("First Polynomial: ");
				firstPoly = scnr.next();
				System.out.print("Second Polynomial: ");
				secondPoly = scnr.next();
				
				//add the display the sum of the polynomials
				combined.addAll(splitPolynomial(firstPoly));
				combined.addAll(splitPolynomial(secondPoly));
				combined = sort(combined);
				combined = sumPolynomial(combined);
				System.out.println(outputPolynomial(combined));
				System.out.println();
				System.out.println("Try again? \n1. Yes\n2. No");
				userChoice = scnr.nextInt();
				
				
			}
			else if (userChoice == 2) {
				System.out.println("Thank you for using the Polynomial Calculator. Have a great day!");
				systemRunning = false;
			}
			else {
				System.out.println("Please pick one of the Menu Options. You will be redirected.\n ");
			}
		}
		
	
		
		
		//need more code :)
		scnr.close();	
	}
}
